# TOURS Card Collector

THE IDOLM@STER TOURS (アイマスTOURS) のアーケードゲームカードを管理するための個人用Webアプリケーションです。
カード画像をアップロードすると、カード情報を自動で読み取り、コレクションを一覧表示・検索できます。重複カードのチェックも可能です。
![image](https://github.com/user-attachments/assets/2ae5a3c8-d505-46d2-89f7-fd34c0ef5323)
![image](https://github.com/user-attachments/assets/73266595-865f-4b3e-9194-f359c5844492)

(本コードはほぼ全体をGemini 2.5 Proによって作成しています。このドキュメントも、です。）

## 主な機能

* **カード登録:** スマートフォンなどで撮影・切り抜いたカード画像をアップロードして登録
    * 右下の「+」ボタン (FAB) から複数枚（最大12枚）同時選択可能
* **情報自動抽出:** Google Gemini APIを利用してカードのID、名前、キャラ名、レアリティ、タイプなどを自動で読み取り
* **重複チェック:** 既に登録済みのカードIDの画像がアップロードされた場合、メッセージでお知らせ
    * 重複カードのファイル名は、Drive上で `カードID_タイムスタンプ.拡張子` となり、一意性を保ちます。
* **カード一覧表示:** 登録したカードを「マイカードスリーブ」に一覧表示
* **並び替え:** 登録日時、カードID、レアリティなどでカードを並び替え表示
* **検索:** カードID、カード名、キャラクター名でカードを絞り込み表示
* **画像拡大:** カード画像クリックで拡大表示

## アプリを利用するために必要なもの

* **Googleアカウント:** `@gmail.com` または Google Workspace のアカウント
* **Webブラウザ:** Google Chrome, Firefox, Microsoft Edge の最新版推奨
* **カード画像:** スマートフォン等で撮影したカードの画像ファイル
    * **推奨:** Microsoft Lensなどのスキャンアプリで、カード部分だけをきれいに切り取った画像を用意すると、情報抽出の精度が上がります。
* **Gemini API キー:** Google AI Studio から取得します（手順は後述）。
* **(方法1の場合) テキストエディタ:** コードをコピー＆ペーストするために、メモ帳やテキストエディットなどの基本的なテキスト編集ソフトが必要です。
* **(方法2の場合) Node.js と npm:** セットアップ用ツール `clasp` をインストールするために必要です。

## セットアップ手順

このアプリをご自身のGoogleアカウントで利用するには、以下のいずれかの方法でセットアップを行ってください。

* **方法1：手動コピー＆ペーストでの設定（対象：コマンドラインツールが苦手な方・ソフトインストールが嫌いな方）**
    * 特別なツールのインストールは不要ですが、ファイルのコピー＆ペースト作業が必要です。
    * パソコン操作に慣れていない方、コマンドラインを使いたくない方におすすめです。
* **方法2：`clasp` を使った設定（推奨：エンジニアの皆様・コントリビューターの方）**
    * `Node.js` と `clasp` というコマンドラインツールのインストールが必要です。
    * コマンドライン操作に抵抗がない方、将来的にコードを更新する可能性がある方におすすめです（更新作業が簡単になります）。

---

### 方法1：手動コピー＆ペーストでの設定（推奨：コマンドライン不要）

この方法では、Webブラウザとテキストエディタ（メモ帳など）を使って設定を進めます。

#### ステップ1: アプリのコードをダウンロード

1.  このGitHubリポジトリのページ右上の「Code」ボタンをクリックします。
2.  「Download ZIP」を選択し、ファイルをダウンロードします。
3.  ダウンロードしたZIPファイルを解凍（展開）します。解凍後のフォルダ（例: `TOURS-Card-Collector-main`）の場所を覚えておいてください。

#### ステップ2: Google Apps Scriptプロジェクトの作成

1.  ご自身のGoogle Driveで「新規」>「その他」>「Google Apps Script」を選択し、空のプロジェクトを作成します。
2.  左上の「無題のプロジェクト」をクリックし、分かりやすい名前（例: `TOURS Card Collector`）に変更します。この名前は後で使いませんが見つけやすくするためです。

#### ステップ3: Google Drive と Google Sheets の準備

アプリのデータを保存する場所を用意します。

1.  **Google Drive フォルダ作成:**
    * ご自身のGoogle Driveを開き、「新規」>「新しいフォルダ」でアプリ用のフォルダを作成します。（例: `TOURS_Card_Images`）
    * 作成したフォルダを開き、ブラウザのアドレスバーURL末尾の `/folders/` の後の **英数字の羅列（フォルダID）** をコピーして、メモ帳などに控えます。
2.  **Google Sheets スプレッドシート作成:**
    * Google Driveで「新規」>「Google スプレッドシート」で新しいスプレッドシートを作成します。
    * ファイル名を変更します。（例: `TOURS_Card_Data`）
    * シート左下のシート名を「**CardList**」に変更します。
    * **重要:** 「CardList」シートの **1行目** に、以下の **ヘッダー** を **順番通りに正確に** 入力します。
        * A1: `CardID`, B1: `Rarity`, C1: `CardType`, D1: `CardName`, E1: `CharacterName`, F1: `ImageFileID`, G1: `FileName`, H1: `RegisteredTimestamp`
        [スクショ：Google Sheetのヘッダー設定例 (A1からH1まで入力された状態)]
    * ブラウザのアドレスバーURL中央の `/d/` と `/edit` の間の **英数字の羅列（スプレッドシートID）** をコピーして、メモ帳などに控えます。

#### ステップ4: Gemini APIキーの取得

カード情報を読み取るためのAPIキーを取得します。

1.  Webブラウザで [Google AI Studio](https://aistudio.google.com/) にアクセスし、Googleアカウントでログインします。
2.  「**Get API key**」または「API キーを取得」ボタンをクリックします。
    ![image](https://github.com/user-attachments/assets/81aeecb8-2225-4069-846e-a2a87cc1aed3)

3.  「APIキーを作成」ボタンをクリックすると、APIキーが作成されます（既存の無料キーを既に発行されている方はそちらを利用するか、作成プロセスを踏んでください）
    ![image](https://github.com/user-attachments/assets/380624f7-0f3b-415c-be4e-457806c14d5b)
    ![image](https://github.com/user-attachments/assets/4a97cd31-28bd-45ad-b4d1-c84a667fd6dd)

5.  生成された長い文字列の **APIキー** をコピーし、**パスワードなどと同様に**安全な場所に保管してください（他人に見せないでください）。
    [スクショ：APIキーが生成・表示された画面（キー自体は隠す）]

#### ステップ5: コードのコピー＆ペースト

ステップ1でダウンロード・解凍したフォルダの中身を、ステップ2で作成したApps Scriptプロジェクトに手動でコピーします。

1.  **Apps Scriptエディタを開く:** ステップ2で作成した Apps Script プロジェクトをブラウザで開きます。
2.  **ファイルを作成してコードを貼り付け:**
    * ダウンロードしたフォルダ内の **`src` フォルダ** を開きます。
    * 以下の表に従って、Apps Scriptエディタでファイルを作成し、対応する `src` フォルダ内のファイルの内容を**全文コピー＆ペースト**してください。
        * **重要:** 貼り付ける前に、Apps Scriptエディタで新しく作成されたファイル内の**既存のコード（`function myFunction(){}` など）は全て削除**してください。
        * 貼り付けたら、必ず**プロジェクトを保存**（フロッピーディスク💾アイコン）してください。

    | 作成するファイルの種類 | Apps Scriptでの作成ファイル名 (拡張子不要) | Apps Script内での表示ファイル名 |コピー元のファイル (`src`フォルダ内) |
    | :--------------------- | :------------------------------------- |:-|:--------------------------------- |
    | スクリプト(既存ファイル)| `コード`                               |`コード.gs`| `コード.js`                          |
    | スクリプト             | `Settings`                             |`Settings.gs` |`Settings.js`                        |
    | スクリプト             | `GeminiAPI`                            |`GeminiAPI.gs` |`GeminiAPI.js`                       |
    | スクリプト             | `SheetManager`                         |`SheetManager.gs` |`SheetManager.js`                      |
    | スクリプト             | `DriveManager`                         |`DriveManager.gs` |`DriveManager.js`                      |
    | HTML                   | `index`                                |`index.html` |`index.html`                         |
    | HTML                   | `javascript`                           |`javascript.html` |`javascript.html`                    |
    | HTML                   | `stylesheet`                           |`stylesheet.html` |`stylesheet.html`                    |

    * **ファイルの作成方法:** エディタ左側の「ファイル」横の「＋」アイコンをクリック → 「スクリプト」または「HTML」を選択 → ファイル名を入力してEnter。
        ![image](https://github.com/user-attachments/assets/c28ce3ad-6f14-4b63-a10b-7bfda255f586)
        ![image](https://github.com/user-attachments/assets/7d15471a-87b7-4378-9f7f-2c8611198983)

3.  **マニフェストファイル (`appsscript.json`) のコピー:**
    * Apps Scriptエディタの左メニュー「**プロジェクトの設定**」（歯車⚙）を開きます。
    * 「**エディタにマニフェスト ファイル「appsscript.json」を表示する**」にチェックを入れます。
       ![image](https://github.com/user-attachments/assets/a08c69a6-4544-4331-9e74-41156813ef51)
    * エディタ（`< >` アイコン）に戻り、ファイル一覧に現れた `appsscript.json` をクリックします。
    * ダウンロード・解凍したフォルダの`src` フォルダにある `appsscript.json` ファイルをテキストエディタで開きます。
    * その内容を**すべてコピー**します。
    * Apps Scriptエディタの `appsscript.json` の内容を**すべて削除**し、コピーした内容を**貼り付け**ます。
    * 「プロジェクトを保存」（フロッピーディスク💾アイコン）をクリックします。

#### ステップ6: 設定値の入力 (スクリプトプロパティ)

1.  Apps Scriptエディタの左メニュー「**プロジェクトの設定**」（歯車⚙）を開きます。
2.  「**スクリプト プロパティ**」セクションを探し、「スクリプト プロパティを編集」をクリックします。
3.  「行を追加」を3回クリックし、以下の情報を入力します。（値はステップ3と4で控えたもの）
    * プロパティ: `DRIVE_FOLDER_ID` / 値: `（あなたのフォルダID）`
    * プロパティ: `SPREADSHEET_ID` / 値: `（あなたのスプレッドシートID）`
    * プロパティ: `GEMINI_API_KEY` / 値: `（あなたのGemini APIキー）`
    ![image](https://github.com/user-attachments/assets/a4742464-b789-41ce-8f04-1fc305265e38)
4.  「スクリプト プロパティを保存」をクリックします。

#### ステップ7: Webアプリとしてデプロイ（公開）

1.  Apps Scriptエディタ右上の「**デプロイ**」>「**新しいデプロイ**」を選択します。
2.  種類の選択の右の歯車⚙をクリックし、「**ウェブアプリ**」を選択します。(`appsscript.json`をコピー済みなら選択済み）
3.  設定:
    * **説明:** （任意。例: `TOURS Card Collector v1.0`）
    * **次のユーザーとして実行:** 「**自分**」
    * **アクセスできるユーザー:** 「**自分のみ**」（**重要！**）
    ![image](https://github.com/user-attachments/assets/e121f031-97d3-4663-a038-02107aff7865)

4.  「**デプロイ**」をクリック。
5.  **承認の実行:** 許可を求められたら「**アクセスを承認**」をクリックし、アカウントを選択します。「確認されていません」画面が出たら「**詳細**」→「**〇〇（プロジェクト名）に移動（安全ではないページ）**」→「**許可**」と進みます。（これは自作アプリでは通常の流れです）
    ![image](https://github.com/user-attachments/assets/5db6d95d-598e-4e22-a20c-b2591bdd8a08)
    ![image](https://github.com/user-attachments/assets/51f37b32-b5b6-487c-82e2-a6d26ce95fb5)
    ![image](https://github.com/user-attachments/assets/7a3aacf4-1d7a-416f-bbc9-9f4ff469a0ee)

6.  デプロイが完了したら、「**ウェブアプリ URL**」をコピーし、ブラウザのブックマークなどに保存します。これがアプリのアドレスです。
    ![image](https://github.com/user-attachments/assets/ab6c6e3e-2335-4edb-8279-09515a4f110a)

7.  「完了」をクリックします。

これでセットアップは完了です！ ブックマークしたURLを開いてアプリを利用できます。

---

### 方法2：`clasp` を使った設定（推奨：コード更新が容易）

（※ この方法はコマンドライン操作が必要です）

#### ステップ1: アプリのコードをダウンロード
...(省略。上記 方法1のステップ1 と同じ)...

#### ステップ2: セットアップ用ツール (`clasp`) の準備

アプリのコードをGoogleアカウントにアップロードするためのツール (`clasp`) をインストールします。

1.  **Node.js のインストール:**
    * [Node.js公式サイト](https://nodejs.org/ja/) にアクセスします。
    * **LTS** と書かれたバージョンのインストーラーをダウンロードし、画面の指示に従ってインストールします。（特に設定を変更する必要はありません）
2.  **ターミナル（コマンドプロンプト）の起動:**
    * **Windows:** スタートメニューで「cmd」と検索して「コマンド プロンプト」を起動します。
    * **Mac:** アプリケーションフォルダ内の「ユーティリティ」フォルダにある「ターミナル」を起動します。
3.  **`clasp` のインストール:** 開いたターミナル（黒い画面）に以下のコマンドを入力し、Enterキーを押します。（コピー＆ペースト推奨）
    ```bash
    npm install -g @google/clasp
    ```
    しばらく待つとインストールが完了します。（いくつかのメッセージが表示される場合があります）
4.  **Googleアカウントへのログイン:** 続けて、ターミナルに以下のコマンドを入力し、Enterキーを押します。
    ```bash
    clasp login
    ```
    ブラウザが自動で開き、Googleアカウントへのログインと `clasp` へのアクセス許可を求められます。アプリを使用したいGoogleアカウントでログインし、画面の指示に従って「許可」をクリックしてください。ターミナルに「Logged in successfully.」と表示されれば成功です。

#### ステップ3: Google Drive と Google Sheets の準備
...(省略。上記 方法1のステップ3 と同じ)...

#### ステップ4: Gemini APIキーの取得
...(省略。上記 方法1のステップ4 と同じ)...

#### ステップ5: アプリのコードをGoogle Apps Scriptに設定
1.  **Google Apps Scriptプロジェクト作成:** Google Driveで新規作成し、名前をつけ、**スクリプトID**をコピーします。
2.  **コードのアップロード:** ターミナルでダウンロード・解凍したフォルダに移動し、以下のコマンドを実行します (`YOUR_SCRIPT_ID` は置き換える)。
    ```bash
    clasp clone "YOUR_SCRIPT_ID" --force
    clasp push
    ```
3.  **設定値の入力:** Apps Scriptエディタを開き、「プロジェクトの設定」>「スクリプト プロパティ」で、`DRIVE_FOLDER_ID`, `SPREADSHEET_ID`, `GEMINI_API_KEY` を設定し保存します。

#### ステップ6: Webアプリとしてデプロイ（公開）
...(省略。上記 方法1のステップ7 と同じ)...

---


## アプリの使い方

1.  セットアップの最後に取得した「ウェブアプリ URL」をブラウザで開きます。
2.  画面右下の「＋」ボタンをクリックします。
3.  ファイル選択ダイアログが開くので、登録したいカード画像（.jpg, .png など）を1枚または複数枚（最大12枚）選択します。
    * Microsoft Lensなどでカード部分だけを切り取った画像を使うことをお勧めします。
4.  選択すると、自動的に処理が始まります。「〇枚のカードを処理中...」というメッセージが表示されます。（枚数が多いと時間がかかります）
5.  処理が完了すると、「〇枚処理完了：新規〇枚、重複〇枚、エラー〇枚」のような結果メッセージが表示されます。重複したカードのIDも表示されます。エラーが出た場合は、開発者コンソール（通常 F12 キーで表示）に詳細が出力されます。
6.  登録されたカードは、「マイカードスリーブ」に表示されます。
7.  画面上部の「並び替え」や「検索」を使って、カードを探すことができます。
8.  カード画像をクリックすると、より大きな画像が表示されます。拡大表示は、画像以外の背景部分をクリックするか、右上の「×」ボタン、または Esc キーで閉じることができます。

## 注意事項・免責事項

* このアプリケーションは個人が作成したものであり、株式会社バンダイナムコエンターテインメント、株式会社バンダイナムコアミューズメント、および THE IDOLM@STER TOURS プロジェクトとは一切関係ありません。
* Gemini API の利用には、Google Cloud Platform の利用規約が適用されます。無料利用枠を超える利用があった場合、現時点（2025/03/30）の規約ではリミットがかかるだけですが、将来的に無償仕様枠を超えると課金される可能性もあります。
* このアプリケーションを使用したことによるいかなる損害についても、作成者は責任を負いません。自己責任でご利用ください。
* カード情報の読み取り精度は、画像の品質やGemini APIの性能に依存するため、100%の精度を保証するものではありません。誤った情報が登録された場合は、Google Sheetsファイル（ステップ3-2で作成）を直接編集して修正してください。
* データはすべてご自身の指定したGoogle DriveとGoogle Sheets内に保存されます。

## トラブルシューティング

* **アプリが開かない/動作しない:**
    * セットアップ手順（特にステップ5-3の設定値入力、ステップ6のデプロイと承認）が正しく完了しているか確認してください。
    * 再度デプロイ（「デプロイ」>「デプロイを管理」> 対象のデプロイを選択 > 編集（鉛筆アイコン）> 新しいバージョンを選択 > 「デプロイ」）を試してみてください。承認を再度求められる場合があります。
* **カード情報が読み取れない/エラーが多い:**
    * アップロードする画像の画質（明るさ、角度、解像度）を確認してください。カード全体が鮮明に写っている必要があります。
    * Gemini APIキーが正しいか、スクリプトプロパティを確認してください。
    * ブラウザの開発者ツール（F12キー）の「コンソール」にエラーメッセージが出ていないか確認してください。
* **ファイル名がカードIDにならない:**
    * スクリプトがGoogle Drive上のファイルを変更する権限が承認されているか確認してください。

--
